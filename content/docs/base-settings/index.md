---
title: "Основные настройки"
weight: 4
toc: true
---

## Конфигурация

`podkop` можно настраивать через `LuCi`: **Services -> podkop**

И через файл конфигурации: `/etc/config/podkop`

### Режимы работы

Есть три режима работы: `Proxy`, `VPN` и `Block`.

#### Proxy

В этом режиме сейчас поддерживаются два протокола: `VLESS` и `Shadowsocks`.

Доступно три варианта настройки:

- **URL подключения | Connection URL**

Используется для ссылки вида **vless://** и **ss://**. Просто вставьте свою ссылку.

> [!NOTE]
> Если ваша строка не поддерживается, пришлите пример строки (без чувствительных данных) и конфигурацию inbound для `Xray` или `sing-box` в чат, чтобы мы могли воспроизвести и протестировать эту конфигурацию. Также вы можете использовать кастомный outbound.

При выбранном режиме `Proxy` доступна еще одна настройка - **Shadowsocks UDP over TCP**.
UDP over TCP используется для передачи UDP-пакетов в TCP. По-умолчанию для `Shadowsocks` отключена функция `UDP over TCP`. Включается с помощью этой галочки. Может быть полезна пользователям `Outline`.

- **Конфигурация Outbound | Outbound Config**

Если по какой-то причине у вас отсутствует ссылка или ваша ссылка не заработала, вы можете скопировать раздел outbounds вашего конфигурационного файла.

В эту строку вы можете вписать любой outbound, который поддерживается `sing-box`. Воспользуйтесь [примерами](https://sing-box.sagernet.org/configuration/outbound/) из его документации.

- **URLTest**

Позволяет указать несколько ссылок `vless://  ss://`. В данном режиме `sing-box` периодически отправляет запросы через каждый из заданных прокси, измеряя время отклика и процент успешных запросов, и на основании этих тестов переключает ссылку. Подробнее [здесь](https://sing-box.sagernet.org/configuration/outbound/urltest/). 

Полезно использовать для резервирования: в случае если один из прокси станет недоступен, `sing-box` автоматически переключит ссылку на действующую.

Вы можете вручную выбрать прокси, используя [yacd](/docs/yacd#ручное-переключение-прокси).

#### VPN

В этом режиме вы выбираете предварительно настроенный интерфейс. Это может быть `Wireguard`, `AmneziaWG`, `OpenVPN`, `OpenConnect` и любой другой туннель или VPN. Достаточно настроить только сам туннель или VPN, настройки firewall и зон не обязательны.

- **Сетевой интерфейс | Network Interface**

Список интерфейсов для выбора

- **Резолвер доменов | Domain Resolver**

Параметр, позволяющий включить отдельный DNS-сервер для выбранного интерфейса. 

Все запросы, направляемые в этот интерфейс, будут разрешаться через выбранный DNS-сервер. Настройка DNS-сервера для 
резолвера доменов аналогична [обычной настройки DNS-сервера](/docs/base-settings/#настройки-dns).

DNS-запросы, отправляемые резолвером доменов, по умолчанию направляются в этот же туннель.

### Block

Этот режим позволяет заблокировать определенные домены и/или подсети. Они будут направлены в Sing-box и отброшены.

### Предустановленные списки | Community Lists

Готовые списки для проксирования. Подробнее о них вы можете узнать [здесь](/docs/sections/).

### Пользовательские списки доменов

Если вы не хотите использовать готовые списки или какие-то домены отсутствуют в них, вы можете добавлять свои с помощью следующих настроек:

#### Тип пользовательского списка доменов | User Domain List Type

Позволяет добавить недостающие домены.

Доступно два режима добавления:

- **Текстовый список | Text List**

  Удобен в случае, если у вас много доменов или вам нужно скопировать их из файла. В качестве разделителя можно использовать запятую, пробел или указать каждый домен с новой строки. Доступны комментарии, при использовании символов `//` перед текстом.

- **Динамический список | Dynamic List**

  Используется для добавления доменов по одному.

Домены указываются в следующем виде:

```
example.com
sub.example.com
```

#### Локальные списки доменов | Local Domain Lists

Вы можете поместить список доменов в файл вида file.lst или file.txt, где каждый домен будет начинаться с новой строки. Пример того как выглядит данный файл вы можете найти в разделе ниже.

#### Удаленные списки доменов | Remote Domains Lists

Доступен вариант загрузки списка доменов с `GitHub` или вашего личного сайта. Необходимо указать полный адрес, с указанием протокола (`http://` или `https://`).

Поддерживаются файлы формата **.srs | .json | .lst | .txt**:

  - **.srs**

  Данный формат представлен в не читаемом для человека виде.

  Один из способов его получения это использовать sing-box:
  ```
  sing-box rule-set compile [--output <file-name>.srs] <file-name>.json
  ```

 Или воспользоваться готовыми решениями: [пример](https://github.com/ampetelin/roscomvpn-rulesets/releases ).

  - **.json**
  
  ```
 {
 "version":3,
  "rules": [
    {
    "domain_suffix": [
      "sub.example.com",
      "example.com"
        ]
      }
    ]
}
  ```

  - **.lst | .txt**
  
  Представляет собой простой текстовый файл, где каждый домен указан с новой строки
  ```
example.com
sub.example.com
  ```

### Пользовательские списки подсетей

Аналогично доменам, вы можете добавить список подсетей.

Подсети указываются в следующем виде:
```
103.21.244.0/22
103.21.244.89
```

Для добавления подсетей доступны следующие опции:

#### Тип пользовательского списка подсетей | User Subnet List Type

Позволяет добавить недостающие подсети.

Доступно два режима добавления:

- **Текстовый список | Text List**

  Удобен в случае, если у вас много подсетей или вам нужно скопировать их из файла. В качестве разделителя можно использовать запятую, пробел или указать каждую подсеть с новой строки. Доступны комментарии, при использовании символов `//` перед текстом.

- **Динамический список | Dynamic List**

  Используется для добавления подсетей или IP адресов по одному.

#### Локальные списки подсетей | Local Subnet Lists

Вы можете поместить список подсетей в файл вида file.lst или file.txt, где каждый домен будет начинаться с новой строки. Пример того как выглядит данный файл вы можете найти в разделе ниже.

#### Удаленные списки подсетей | Remote Subnet Lists

Доступен вариант загрузки списка подсетей с `GitHub` или вашего личного сайта. Необходимо указать `CIDR` или одиночный IP. Необходимо указать полный адрес, с указанием протокола (`http://` или `https://`).

Поддерживаются файлы формата **.srs | .json | .lst | .txt**.

  - **.srs**

  Данный формат представлен в не читаемом для человека виде.

  Один из способов его получения это использовать sing-box:
  ```
  sing-box rule-set compile [--output <file-name>.srs] <file-name>.json
  ```

 Или воспользоваться готовыми решениями, [например](https://github.com/ampetelin/roscomvpn-rulesets/releases ).

  - **.json**
  
  ```
{
"version":3,
  "rules": [
    {
    "ip_cidr": [
      "10.0.0.0/24",
      "192.168.0.1"
        ]
      }
    ]
  }
  ```

  - **.lst | .txt**
  
  Представляет собой простой текстовый файл, где каждая подсеть указана с новой строки в следующем виде:

  ```
  103.21.244.0/22
  103.21.244.89
  ```

### Исключение/направление всего трафика в туннель

Для того чтобы исключить или направить трафик с конкретного устройства в туннель предусмотрены следующие настройки:

#### Принудительное прокси IP | IP for full redirection

Направляет весь трафик с конкретного устройства в туннель. Для этого требуется указать IP устройства.

Чтобы узнать IP устройства, вам нужно зайти в веб-интерфейс роутера и перейти в **Status -> Overview или Network -> DHCP and DNS -> Static Leases**. В разделе `Active DHCP Leases` отображаются выданные вашим устройствам IP. При необходимости вы можете сделать их статическими нажав кнопку **Set Static** или **Add** и добавить необходимое устройство.

#### Исключение прокси IP | IP for exclusion

Если вам требуется исключить устройство из проксирования, то вы можете указать его IP в данной опции.

### Включить смешанный режим | Mixed enable

Позволяет поднять на роутере `SOCKS` прокси и направлять весь трафик с определенного приложения на роутере или в локальной сети в прокси.
Например, в браузере или на компьютере вы можете настроить прокси и тогда весь трафик с него отправится в туннель.

## Дополнительные настройки | Additional Settings

### Включить Yacd | Yacd enable

`Yacd (Clash API)` представляет собой дополнительную веб-панель, в которой вы можете увидеть уходят ли соединения в туннель, потребление памяти и правила, используемые `sing-box`. Подробнее [здесь](/docs/yacd/).

### Исключить NTP | Exclude NTP

Позволяет исключить направление трафика NTP-протокола в туннель/proxy. Может быть необходимо, при использовании умных колонок от Яндекс и в других ситуациях, если у вас остается много незакрытых соединений и из-за этого растет потребление оперативной памяти роутера.

### Отключить QUIC | QUIC disable

Позволяет отключить использование протокола `QUIC`. Может быть полезно при проблемах с YouTube на Android-устройствах.

### Частота обновления списков | List Update Frequency

С какой частотой будут обновляться предустановленные списки доменов.

### Настройки DNS

DNS-сервер, который будет использован для всех DNS-запросов (в том числе и для сайтов не из списков) во время работы `podkop`.

#### Тип DNS протокола | DNS Protocol Type

Позволяет выбрать тип DNS-протокола:

- DoH (DNS over HTTPS)
- DoT (DNS over TLS)
- UDP (Без шифрования)

#### DNS-сервер | DNS Server

Позволяет выбрать предустановленный DNS-сервер или указать свой.

#### Bootstrap DNS-сервер | Bootstrap DNS Server

UDP DNS-сервер, используемый для поиска IP-адресов вышестоящего DNS-сервера, адрес которого указан доменным именем

#### Перезапись TTL для DNS | DNS Rewrite TTL

Время в секундах, в течение которого DNS-запись с IP адресом из `FakeIP` подсети будет храниться в кэше устройств. Рекомендуется использовать дефолтное значение.

Если файл кэша хранится в RAM, то после перезагрузки роутера "старые" зарезолвленные фейковые IP адреса останутся на устройстве и не будут работать с "новым" кэшем.

Именно поэтому `TTL` по-умолчанию установлен в **1 минуту** - оптимальное значение: после ребута роутера они пропадут с ваших устройств и DNS-запросы к роутеру будут ходить не слишком часто.

#### Путь к файлу конфигурации | Config File Path

Место, где будет храниться конфиг `sing-box`: во **Flash** или **RAM**. По умолчанию используется внутренняя память устройства.

#### Путь к файлу кэша | Cache File Path

Место, где будет храниться кэш от DNS-записей и предустановленные списки. По умолчанию хранится в **/tmp** (раздел в RAM).

Вы можете хранить его в NAND, но это уже на ваш страх и риск. Также можно вынести на внешний накопитель, указать путь к нему в этом поле.

### Source Network interface

Позволяет выбрать интерфейс(ы), с которого(ых) трафик должен идти в прокси. Следует изменить, если у вас локальная сеть на нестандартном `br-lan` или если вам необходимо перенаправление трафика с дополнительного интерфейса, например `wg0`.

### Interface Monitoring

Если у вас нестабильное соединение на WAN, то sing-box может терять интерфейс, в который ему нужно направлять трафик. На практике такое встречается при использовании плохо реализованых PPPoE-соединений и USB-модемов.

Подробнее о настройке вы можете узнать [здесь](/docs/badwan/).

### Dont touch my DHCP!

По умолчанию podkop редактирует /etc/config/dhcp, чтобы прописать sing-box в качестве основного DNS-сервера. Без этого невозможна работа со схемой FakeIP/FakeDNS. Эта опция отключает эту функцию, и вы можете редактировать конфигурацию dnsmasq как вам потребуется.

Подробнее о настройке вы можете узнать [здесь](/docs/dont-touch-my-dhcp/).

### Proxy download of lists

Если у вас заблокирован github или другой ресурс, с которого вам необходимо загружать списки доменов для работы в Podkop, вы можете воспользоваться данной опцией. При её включении списки будут загружаться с использованием туннеля указанного в первой секции Podkop. 
