---
title: 'Дружим с AdGuardHome'
weight: 25
---

Для корректной работы `Podkop` необходимо обеспечить прохождение всех DNS-запросов через него. 

В связке с AdGuard Home (AGH) это можно реализовать двумя способами:
1. Указать AGH как DNS-сервер в конфигурации Podkop
2. Прописать роутер как Upstream DNS-сервер в AGH, а клиентам раздать адрес AGH по DHCP. Этот вариант позволяет получать 
статистику по отдельным клиентам

## AGH как DNS-сервер в Podkop
![podkop-agh](images/podkop-agh.png)

### AGH на роутере
Измените конфигурацию AGH в файле `/etc/adguardhome.yaml`, установив loopback-адрес для прослушивания, 
отличный от `127.0.0.1`:
```
bind_hosts : 127.0.0.10, 
port : 53
```
> [!WARNING]
> Не используйте loopback-адреса 127.0.0.42 и 127.0.0.53, так как они будут конфликтовать с другими службами

После внесения изменений перезапустите AGH:
```
service adguardhome restart
```

Затем настройте параметры DNS-сервера в Podkop:
- DNS Protocol Type: UDP
- DNS Server: 127.0.0.10

### AGH на другом устройстве
Если AGH установлен на отдельном устройстве локальной сети (например, 192.168.1.10), в параметрах DNS-сервера Podkop 
укажите:
- DNS Protocol Type: UDP
- DNS Server: 192.168.1.10

### Проверка и дополнительные настройки
После настройки убедитесь, что AGH принимает DNS-запросы — это можно проверить в веб-интерфейсе AGH (раздел "Журнал").

Также не забудьте настроить Upstream DNS-серверы в интерфейсе AGH в соответствии с вашими предпочтениями (например, 
https://dns.google/dns-query, tls://dns.adguard-dns.com и т.д.).

## AGH как DNS-сервер у клиентов
![podkop-agh](images/agh-podkop.png)
В этом сценарии AdGuard Home (AGH) выступает в роли основного DNS-сервера для клиентов локальной сети. 
Все DNS-запросы от устройств сначала поступают в AGH и затем перенаправляются в Podkop.

### Общий принцип работы
1) Клиенты локальной сети получают IP-адрес и адрес DNS-сервера с помощью DHCP-сервера роутера
2) AGH принимает DNS-запросы от клиентов, фильтрует их, собирает статистику и передаёт запросы дальше — в Podkop
3) Podkop, в свою очередь, передаёт их внешним DNS-провайдерам

### Настройка DHCP на роутере
В настройках DHCP-сервера на вашем роутере:
- Укажите IP-адрес устройства с AGH в качестве основного DNS-сервера

Например, если AGH установлен на 192.168.1.10, пропишите его в поле DNS-сервера DHCP.
Это обеспечит то, что все устройства в сети (смартфоны, ПК, ТВ и т.д.) будут использовать AGH как DNS.

### Настройка AGH
В интерфейсе AdGuard Home:
1) Перейдите в Настройки → Настройки DNS
2) В разделе `Upstream DNS-серверы` укажите IP-адрес вашего роутера с Podkop

Например: `192.168.1.1`